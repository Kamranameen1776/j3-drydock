<section class="grid-header-container">
  <jb-grid-header
    class="grid-header"
    [gridName]="gridName"
    [additionalFilters]="additionalFilters"
    [isDisplayAdvancedFilter]="false"
    [isDisplayAdvancedSettings]="false"
    (filterAction)="onFilterChange($event)"
  ></jb-grid-header>
</section>

<p-table
  class="comparison-table"
  [columns]="yards"
  [value]="[1]"
  [scrollable]="true"
  scrollHeight="300px"
  [reorderableColumns]="true"
  [virtualScroll]="true"
>
  <ng-template
    pTemplate="header"
    let-columns
  >
    <tr>
      <th
        class="sticky comparison-table-column"
        [class.collapsed]="isTableInCollapsedMode"
      >
        <tr>
          <th colspan="4">
            <jb-drydock-comparison-table-header class="visibility-hidden"></jb-drydock-comparison-table-header>
          </th>
        </tr>
      </th>
      <th
        colspan="4"
        *ngFor="let yard of columns"
        class="comparison-table-column"
        pReorderableColumn
      >
        <jb-drydock-comparison-table-header [yard]="yard"></jb-drydock-comparison-table-header>
      </th>
    </tr>
  </ng-template>
  <ng-template
    pTemplate="body"
    let-columns="columns"
  >
    <tr class="comparison-body">
      <td
        [class.collapsed]="isTableInCollapsedMode"
        class="sticky comparison-table-column"
      >
        <!-- TODO move to separate component -->
        <p-treeTable
          [value]="yardFunctions"
          [columns]="baseColumns"
          [rows]="20"
          (onNodeExpand)="onNodeExpand($event)"
          (onNodeCollapse)="onNodeCollapse($event)"
        >
          <ng-template
            pTemplate="colgroup"
            let-columns
          >
            <colgroup>
              <col
                *ngFor="let col of columns"
                [style.width]="col.width"
              />
            </colgroup>
          </ng-template>

          <ng-template
            pTemplate="header"
            let-columns
          >
            <tr [ttRow]="rowNode">
              <th
                *ngFor="let col of columns; let i = index"
                class="comparison-th"
              >
                <span>{{ col.header }}</span>
                <i
                  *ngIf="i === columns.length - 1"
                  [class]="isTableInCollapsedMode ? 'icons8-circled-chevron-right-filled' : 'icons8-circled-chevron-left-filled'"
                  (click)="onToggleTableMode()"
                ></i>
              </th>
            </tr>
          </ng-template>

          <ng-template
            pTemplate="body"
            let-rowNode
            let-rowData="rowData"
            let-columns="columns"
          >
            <tr style="height: 52px">
              <td *ngFor="let col of columns; let i = index">
                <p-treeTableToggler
                  [rowNode]="rowNode"
                  *ngIf="i === 0"
                ></p-treeTableToggler>
                <span>{{ rowData[col.field] }}</span>
              </td>
            </tr>
          </ng-template>
        </p-treeTable>
      </td>
      <td
        *ngFor="let yard of yards"
        class="comparison-table-column"
      >
        <!-- TODO move to separate component-->
        <div class="comparison-table-card">
          <p-table
            [value]="yard.rows | comparisonRows: expandedRowsSet : 'spec_uid'"
            [columns]="cardColumns"
            [rows]="20"
          >
            <ng-template
              pTemplate="colgroup"
              let-columns
            >
              <colgroup>
                <col
                  *ngFor="let col of columns"
                  [style.width]="col.width"
                />
              </colgroup>
            </ng-template>

            <ng-template
              pTemplate="header"
              let-columns
            >
              <tr>
                <th *ngFor="let col of columns; let i = index">
                  <span>{{ col.header }}</span>
                </th>
              </tr>
            </ng-template>

            <ng-template
              pTemplate="body"
              let-rowData
              let-columns="columns"
            >
              <tr
                style="height: 52px"
                class="row-highlight"
              >
                <td *ngFor="let col of columns; let i = index">
                  <span>{{ rowData[col.field] === null ? '' : rowData[col.field] }}</span>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>
